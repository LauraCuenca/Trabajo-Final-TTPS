<div class="container-custom">
  <h1>Asentar Nueva Venta</h1><br>

  <%= form_with model: @venta, url: ventas_asentar_path do |form| %>
    <div class="form-group">
      <%= form.label :empleado_id, "Empleado" %>
      <%= form.collection_select :id_empleado, User.where(role: :empleado), :id, :username, prompt: "Seleccionar empleado", class: 'form-control' %>
    </div>

    <div id="productos" class="form-group">
      <h2>Productos a Vender</h2>
      <%= form.fields_for :detalle_ventas do |detalle_form| %>
        <div class="producto-item">
          <div class="form-group">
            <%= detalle_form.label :producto_id, "Producto" %>
            <%= detalle_form.collection_select :producto_id, Producto.all, :id, :nombre, prompt: "Seleccionar un producto", class: 'form-control' %>
          </div>

          <div class="form-group">
            <%= detalle_form.label :cantidad, "Cantidad" %>
            <%= detalle_form.number_field :cantidad, class: 'form-control', min: 1 %>
          </div>

          <div class="form-group">
            <%= detalle_form.label :precio_venta, "Precio de Venta" %>
            <%= detalle_form.number_field :precio_venta, class: 'form-control', step: 0.01, min: 0 %>
          </div>
          
          <button type="button" class="btn btn-danger remove-producto" data-id="producto-item-<%= detalle_form.object.object_id %>">Eliminar Producto</button>
        </div>
      <% end %>

      <button type="button" id="add-producto" class="btn btn-success">Agregar Producto</button>
    </div>

    <%= form.submit "Registrar Venta", class: 'btn btn-primary' %>
  <% end %>
</div>

<script>
  document.getElementById('add-producto').addEventListener('click', function() {
    var productoHTML = document.querySelector('.producto-item').cloneNode(true);
    document.getElementById('productos').appendChild(productoHTML);
  });

  document.querySelector('#productos').addEventListener('click', function(e) {
    if (e.target.classList.contains('remove-producto')) {
      e.target.closest('.producto-item').remove();
    }
  });
</script>
